{% extends 'base-mgmt.html' %}
{% load recurse %}
{% load static %}
{% load bootstrap4 %}
{% load i18n %}
{% bootstrap_messages %}
{% block head %}
    <title>{% trans "accounting" %}</title>
{% endblock %}
{% block body %}
    <div class="row">
        <div class="col">
            <h1>{% trans 'Dashboard' %}</h1>
        </div>
    </div>
    <div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h4 class="h-bold">{% trans "Menu" %}</h4>
            </div>
            <div class="card-body">
                <a href="{% url 'management_index' %}"
                   class="btn btn-fw btn-primary">{% trans 'Go back to management' %}</a>
            </div>
            <div class="card-body">
                <div class="card-title h4">{% trans 'Filter' %}</div>
                <form action="" method="get">

                    {% bootstrap_form filter.form exclude='date_added'%}
                    <div class="form-group has-success"><label for="id_date_added_0">Date (Between)</label>
                        <input
                            type="date" name="date_added_after" class="form-control has-success" value="{{ filter.form.data.date_added_after }}"
                            placeholder="Date (Between)" title="" id="id_date_added_0">
                        - <input type="date" name="date_added_before" class="form-control has-success" value="{{ filter.form.data.date_added_before }}"
                                placeholder="Date (Between)" title="" id="id_date_added_1">
                    </div>
                    <button class="btn btn-fw btn-primary" type="submit">{% trans 'Go' %}</button>

                </form>
                <hr>
                <a href="{% url 'management_index' %}"
                   class="btn btn-fw btn-primary">{% trans 'Go back to management' %}</a>
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-9 mt-2 mt-md-0">

        <div class="row">
            <div class="col-md-3">
                <div class="card bg-light">
                    <div class="card-body p-3">
                        <div class="text-uppercase"><span>{% trans 'Total Amount' %}</span>
                            <span
                                    class="float-right"><i class="fas fa-coins fa-2x"></i>
                    </span>
                        </div>
                        <div><span class="text-bold badge badge-pill badge-primary">{{ total_brutto }} €</span><br>
                            <span class="mt-2 text-bold badge badge-pill badge-secondary">{{ total_netto }} €</span>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <a href="{% url "management_all_orders" %}?state={{ open_order_state_id }}&contact=">
                    <div class="card bg-light">

                        <div class="card-body p-3">

                            <div class="text-uppercase"><span>{% trans 'Open Orders' %}</span>
                                <span
                                        class="float-right"><i class="fas fa-shopping-basket fa-2x"></i>
                            </span>
                            </div>
                            <div><span
                                    class="text-bold badge badge-pill badge-primary">{{ counted_open_orders }}</span>
                            </div>

                        </div>

                    </div>
                </a>
            </div>
            <div class="col-md-3">
                <div class="card bg-light">
                    <div class="card-body p-3">
                        <div class="text-uppercase text-break"><span>{% trans 'Open Shipments' %}</span>
                            <span
                                    class="float-right"><i class="fas fa-shipping-fast fa-2x"></i>
                    </span>
                        </div>
                        <div><span
                                class="text-bold badge badge-pill badge-danger">{{ counted_open_shipments }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-light">
                    <div class="card-body p-3">
                        <div class="text-uppercase"><span>{% trans 'Open Payments' %}</span>
                            <span
                                    class="float-right"><i class="fas fa-hand-holding-usd fa-2x"></i>
                    </span>
                        </div>
                        <div><span
                                class="text-bold badge badge-pill badge-danger">{{ counted_open_payments }}</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="row mt-3">
            <div class="col">
                <div class="card">
                    <div class="card-header">{% trans 'Last Orders' %}
                        <form action="{% url 'accounting:export_csv' %}" method="get">
                            <div class="hidden">

                                {% bootstrap_form filter.form %}
                            </div>
                            <button type="submit" >Export</button>
                        </form>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            {% for order in filter.qs %}
                                <a href="{% url 'management_detail_order' order.order.order_hash %}"
                                   class="list-group-item list-group-item-action ">
                                    <div class="row">
                                        <div class="col-4 font-weight-bold overflow-auto">{% trans 'Ordernr' %}</div>
                                        <div class="col-4 font-weight-bold overflow-auto">{% trans 'Orderdate' %}</div>
                                        <div class="col-4 font-weight-bold overflow-auto">{% trans 'Billdate' %}</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">{{ order.unique_nr }}</div>
                                        <div class="col-4">{{ order.date_added }}</div>
                                        <div class="col-4">{{ order.date_bill }}</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <div class="progress">
                                                <div class="progress-bar
                                        {% if order.state.initial %}
                                        bg-danger" aria-valuenow="20" style="width:20%"
                                                {% endif %}{% if order.state.is_paid_state %}
                                                     bg-warning" aria-valuenow="50" style="width:50%"
                                                {% endif %}{% if order.state.is_sent_state %}
                                                    bg-success" aria-valuenow="100" style="width:100%"
                                                {% elif order.state.next_state %}
                                                    bg-warning" aria-valuenow="50" style="width:50%"
                                                {% else %}
                                                    bg-warning" aria-valuenow="100" style="width:100%"
                                                    role="progressbar"
                                                    aria-valuemin="0" aria-valuemax="100"
                                                {% endif %}>
                                                {{ order.state.name }}
                                                {% if not order.state %}
                                                    {% trans 'Shoppingcart' %}

                                            {% endif %}
                                            </div>
                                            </div>

                                        </div>
                                        <div class="col-4">
                                            {{ order.total }} €
                                        </div>
                                    </div>

                                </a>
                            {% endfor %}

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
